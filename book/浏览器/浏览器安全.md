### XSS (Cross Site Scripting)

跨站脚本攻击，`XSS` 攻击是指浏览器中执行恶意脚本(无论是跨域还是同域)，从而拿到用户的信息并进行操作。

- 窃取cookie
- 监听用户行为，比如输入账号密码后直接发送到黑客服务器
- 修改 DOM 伪造登录表单
- 在页面中生成浮窗广告

#### 存储型

存储型就是将恶意代码存储到数据库中。一般比如通过留言板提交内容，而服务端没有做好相关转移的话就将恶意代码直接存到数据库中了。在渲染的时候就能直接执行恶意代码了。

#### 反射型

反射型XSS指的是恶意脚本作为网络请求的一部分，

```html
http://sanyuan.com?q=<script>alert("你完蛋了")</script>
```

在服务器端会拿到q参数,然后将内容返回给浏览器端，浏览器将这些内容作为HTML的一部分解析，发现是一个脚本，直接执行，这样就被攻击了。

#### 文档型

文档型的 XSS 攻击并不会经过服务端，而是作为中间人的角色，在数据传输过程劫持到网络数据包，然后修改里面的 html 文档，这样的劫持方式包括WIFI路由器劫持或者本地恶意软件等。

#### 如何解决

1. 不相信用户的任何输入，都给转义一下。
2. 对服务器返回的内容不直接进行innerHTML渲染，而是渲染成文本。比如Vue中的`v-html`与`{{}}`
3. 利用CSP

    CSP，即浏览器中的内容安全策略，它的核心思想就是服务器决定浏览器加载哪些资源，具体来说可以完成以下功能:

        限制其他域下的资源加载。
        禁止向其它域提交数据。
        提供上报机制，能帮助我们及时发现 XSS 攻击。

4. 利用cookie的`httpOnly`属性，禁止浏览器端获取cookie

5. 为`cookie`设置较短的过期时间

### CSRF

CSRF(Cross-site request forgery), 即跨站请求伪造，指的是黑客诱导用户点击链接，打开黑客的网站，然后黑客利用用户目前的登录状态发起跨站请求。

CSRF 主要是利用cookie进行请求伪造，比如打开了黑客页面，黑客页面有

```html
<img src="https://xxx.com/info?user=hhh&count=100">
```

这个时候就会自动发起对`xxx.com`的请求，如果之前在`xxx.com`网站登录过，而服务端又没有任何限制的话，就认为这是一个合规的请求，并进行相关操作。

#### 如何防范

主要是在服务端对请求来源做区分，以及设置cookie限制

1. 请求头的`Origin`和`Referer`。
    `Origin`只包含域名信息
    `Referer`包含了具体的` URL `路径。

当然，这两者都是可以伪造的，通过` Ajax `中自定义请求头即可，安全性略差

2. 利用Cookie的`SameSite`属性

`SameSite`可以设置为三个值，`Strict`、`Lax`和`None`。

- 在`Strict`模式下，浏览器完全禁止第三方请求携带Cookie。比如请求sanyuan.com网站只能在sanyuan.com域名当中请求才能携带 Cookie，在其他网站请求都不能。

- 在`Lax`模式，就宽松一点了，但是只能在` get `方法提交表单况或者`a `标签发送` get `请求的情况下可以携带 `Cookie`，其他情况均不能。

- 在`None`模式下，也就是默认模式，请求会自动携带上 `Cookie`

3. CSRF Token

服务端在返回网页的时候在页面中写入一个token，浏览器端每次操作的时候都携带上这个token。然后服务器来验证是否合法，如果不合法则不予响应。这个字符串也就是`CSRF Token`，通常第三方站点无法拿到这个 `token`, 因此也就是被服务器给拒绝。

### 中间人攻击

http协议采用明文传输，在传输层中的各个环节都可能被劫持篡改。


